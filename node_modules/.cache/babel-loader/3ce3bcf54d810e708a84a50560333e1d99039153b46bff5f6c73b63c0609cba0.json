{"ast":null,"code":"var _jsxFileName = \"D:\\\\GITHUB\\\\ACM\\\\gate-pass-app\\\\client\\\\src\\\\components\\\\BarcodeScanner.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport { Html5Qrcode, Html5QrcodeSupportedFormats } from \"html5-qrcode\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ALL_FORMATS = [Html5QrcodeSupportedFormats.QR_CODE, Html5QrcodeSupportedFormats.CODE_128, Html5QrcodeSupportedFormats.CODE_39, Html5QrcodeSupportedFormats.CODE_93, Html5QrcodeSupportedFormats.EAN_13, Html5QrcodeSupportedFormats.EAN_8, Html5QrcodeSupportedFormats.UPC_A, Html5QrcodeSupportedFormats.UPC_E, Html5QrcodeSupportedFormats.ITF, Html5QrcodeSupportedFormats.CODABAR, Html5QrcodeSupportedFormats.DATA_MATRIX, Html5QrcodeSupportedFormats.PDF_417, Html5QrcodeSupportedFormats.AZTEC];\nfunction BarcodeScanner({\n  onScan,\n  loading\n}) {\n  _s();\n  const [scanning, setScanning] = useState(false);\n  const [starting, setStarting] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [torchOn, setTorchOn] = useState(false);\n  const [torchSupported, setTorchSupported] = useState(false);\n  const [cameraType, setCameraType] = useState(\"environment\");\n  const scannerRef = useRef(null);\n  const lastScanRef = useRef(\"\");\n  const lastScanTimeRef = useRef(0);\n  const stopScanner = useCallback(async () => {\n    if (scannerRef.current) {\n      try {\n        const state = scannerRef.current.getState();\n        if (state === 2) {\n          await scannerRef.current.stop();\n        }\n        scannerRef.current.clear();\n      } catch (e) {\n        // ignore\n      }\n      scannerRef.current = null;\n    }\n    setScanning(false);\n    setStarting(false);\n    setTorchOn(false);\n    setTorchSupported(false);\n  }, []);\n  const toggleTorch = useCallback(async () => {\n    if (!scannerRef.current) return;\n    try {\n      var _scannerRef$current$g, _scannerRef$current, _scannerRef$current$g2, _scannerRef$current2, _videoTrack$torchFeat;\n      const track = (_scannerRef$current$g = (_scannerRef$current = scannerRef.current).getRunningTrackSettings) === null || _scannerRef$current$g === void 0 ? void 0 : _scannerRef$current$g.call(_scannerRef$current);\n      if (!track) return;\n      const videoTrack = (_scannerRef$current$g2 = (_scannerRef$current2 = scannerRef.current).getRunningTrackCameraCapabilities) === null || _scannerRef$current$g2 === void 0 ? void 0 : _scannerRef$current$g2.call(_scannerRef$current2);\n      if (videoTrack !== null && videoTrack !== void 0 && (_videoTrack$torchFeat = videoTrack.torchFeature) !== null && _videoTrack$torchFeat !== void 0 && _videoTrack$torchFeat.call(videoTrack)) {\n        const newState = !torchOn;\n        await videoTrack.torchFeature().apply(newState);\n        setTorchOn(newState);\n      }\n    } catch (e) {\n      // Try alternative method\n      try {\n        const video = document.querySelector(\"#barcode-reader video\");\n        if (video && video.srcObject) {\n          const track = video.srcObject.getVideoTracks()[0];\n          if (track) {\n            await track.applyConstraints({\n              advanced: [{\n                torch: !torchOn\n              }]\n            });\n            setTorchOn(!torchOn);\n          }\n        }\n      } catch (e2) {\n        console.log(\"Torch not supported\");\n      }\n    }\n  }, [torchOn]);\n  const switchCamera = useCallback(async () => {\n    const newType = cameraType === \"environment\" ? \"user\" : \"environment\";\n    setCameraType(newType);\n    if (scanning) {\n      await stopScanner();\n      // Small delay then restart\n      setTimeout(() => {\n        startScannerWithCamera(newType);\n      }, 500);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [cameraType, scanning, stopScanner]);\n  const startScannerWithCamera = useCallback(async facingMode => {\n    setError(\"\");\n    setStarting(true);\n    await new Promise(r => setTimeout(r, 400));\n    try {\n      const el = document.getElementById(\"barcode-reader\");\n      if (!el) {\n        setError(\"Scanner element not found. Try refreshing.\");\n        setStarting(false);\n        return;\n      }\n      if (scannerRef.current) {\n        try {\n          await scannerRef.current.stop();\n        } catch (e) {}\n        try {\n          scannerRef.current.clear();\n        } catch (e) {}\n      }\n      el.innerHTML = \"\";\n      const scanner = new Html5Qrcode(\"barcode-reader\", {\n        formatsToSupport: ALL_FORMATS,\n        verbose: false,\n        experimentalFeatures: {\n          useBarCodeDetectorIfSupported: true // Use native BarcodeDetector API if available (faster + better blur handling)\n        }\n      });\n      scannerRef.current = scanner;\n\n      // Get available cameras and pick rear HD camera\n      let cameraConfig = {\n        facingMode: facingMode || \"environment\"\n      };\n      try {\n        const cameras = await Html5Qrcode.getCameras();\n        if (cameras && cameras.length > 0) {\n          // Prefer rear camera\n          const rearCam = cameras.find(c => c.label.toLowerCase().includes(\"back\") || c.label.toLowerCase().includes(\"rear\") || c.label.toLowerCase().includes(\"environment\"));\n          if (rearCam && facingMode !== \"user\") {\n            cameraConfig = rearCam.id;\n          }\n        }\n      } catch (e) {\n        // fallback to facingMode\n      }\n      await scanner.start(cameraConfig, {\n        fps: 15,\n        // Higher FPS = more scan attempts\n        qrbox: (viewfinderWidth, viewfinderHeight) => {\n          // Use 85% of the viewport for scanning area — larger = better for blur\n          const w = Math.floor(viewfinderWidth * 0.85);\n          const h = Math.floor(viewfinderHeight * 0.65);\n          return {\n            width: Math.max(w, 250),\n            height: Math.max(h, 150)\n          };\n        },\n        aspectRatio: 1.5,\n        disableFlip: false,\n        experimentalFeatures: {\n          useBarCodeDetectorIfSupported: true\n        }\n      }, decodedText => {\n        // Debounce: prevent rapid duplicate scans\n        const now = Date.now();\n        if (decodedText === lastScanRef.current && now - lastScanTimeRef.current < 3000) {\n          return;\n        }\n        lastScanRef.current = decodedText;\n        lastScanTimeRef.current = now;\n\n        // Vibrate on successful scan (mobile)\n        if (navigator.vibrate) navigator.vibrate(200);\n        onScan(decodedText.trim());\n        stopScanner();\n      }, () => {});\n      setScanning(true);\n      setStarting(false);\n\n      // After scanner starts, force HD + continuous autofocus + sharpness\n      const applyHDConstraints = async () => {\n        try {\n          var _track$getCapabilitie, _capabilities$focusMo, _capabilities$focusMo2;\n          const video = document.querySelector(\"#barcode-reader video\");\n          if (!video || !video.srcObject) return;\n          const track = video.srcObject.getVideoTracks()[0];\n          if (!track) return;\n          const capabilities = ((_track$getCapabilitie = track.getCapabilities) === null || _track$getCapabilitie === void 0 ? void 0 : _track$getCapabilitie.call(track)) || {};\n\n          // Build constraints\n          const constraints = {};\n          const advanced = [];\n\n          // Force highest resolution possible\n          if (capabilities.width) {\n            constraints.width = {\n              ideal: Math.min(capabilities.width.max || 1920, 1920)\n            };\n          }\n          if (capabilities.height) {\n            constraints.height = {\n              ideal: Math.min(capabilities.height.max || 1080, 1080)\n            };\n          }\n\n          // Continuous autofocus — CRITICAL for blur\n          if ((_capabilities$focusMo = capabilities.focusMode) !== null && _capabilities$focusMo !== void 0 && _capabilities$focusMo.includes(\"continuous\")) {\n            advanced.push({\n              focusMode: \"continuous\"\n            });\n          } else if ((_capabilities$focusMo2 = capabilities.focusMode) !== null && _capabilities$focusMo2 !== void 0 && _capabilities$focusMo2.includes(\"auto\")) {\n            advanced.push({\n              focusMode: \"auto\"\n            });\n          }\n\n          // Sharpness boost if supported\n          if (capabilities.sharpness) {\n            advanced.push({\n              sharpness: capabilities.sharpness.max || 100\n            });\n          }\n\n          // Contrast boost if supported  \n          if (capabilities.contrast) {\n            advanced.push({\n              contrast: Math.min(capabilities.contrast.max || 100, 150)\n            });\n          }\n\n          // Exposure compensation for clearer image\n          if (capabilities.exposureCompensation) {\n            advanced.push({\n              exposureCompensation: 0\n            });\n          }\n\n          // Torch support check\n          if (capabilities.torch) {\n            setTorchSupported(true);\n          }\n          if (advanced.length > 0) {\n            constraints.advanced = advanced;\n          }\n          await track.applyConstraints(constraints);\n\n          // Apply CSS sharpening filter on the video for visual clarity\n          video.style.filter = \"contrast(1.15) brightness(1.05)\";\n        } catch (e) {\n          // Non-critical, ignore\n        }\n      };\n\n      // Apply immediately + retry after 1s (some cameras need time)\n      setTimeout(applyHDConstraints, 500);\n      setTimeout(applyHDConstraints, 1500);\n    } catch (err) {\n      console.error(\"Scanner error:\", err);\n      setStarting(false);\n      if (err.toString().includes(\"NotAllowedError\")) {\n        setError(\"Camera permission denied. Please allow camera access in your browser settings.\");\n      } else if (err.toString().includes(\"NotFoundError\")) {\n        setError(\"No camera found on this device.\");\n      } else if (err.toString().includes(\"NotReadableError\")) {\n        setError(\"Camera is in use by another app. Please close it and try again.\");\n      } else {\n        setError(\"Failed to start camera: \" + err.toString());\n      }\n    }\n  }, [onScan, stopScanner]);\n  const startScanner = useCallback(() => {\n    startScannerWithCamera(cameraType);\n  }, [cameraType, startScannerWithCamera]);\n  useEffect(() => {\n    return () => {\n      if (scannerRef.current) {\n        try {\n          scannerRef.current.stop();\n        } catch (e) {}\n        try {\n          scannerRef.current.clear();\n        } catch (e) {}\n      }\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"barcode-scanner\",\n    children: [!scanning && !starting && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"scanner-start\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"start-scan-btn\",\n        onClick: startScanner,\n        disabled: loading,\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          viewBox: \"0 0 24 24\",\n          width: \"24\",\n          height: \"24\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          strokeWidth: \"2\",\n          children: [/*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M3 7V5a2 2 0 012-2h2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M17 3h2a2 2 0 012 2v2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M21 17v2a2 2 0 01-2 2h-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M7 21H5a2 2 0 01-2-2v-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"7\",\n            y1: \"12\",\n            x2: \"17\",\n            y2: \"12\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"7\",\n            y1: \"8\",\n            x2: \"13\",\n            y2: \"8\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n            x1: \"7\",\n            y1: \"16\",\n            x2: \"15\",\n            y2: \"16\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 13\n        }, this), \"Open Camera & Scan Barcode\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"scanner-hint\",\n        children: \"Point your camera at the barcode on the participant's ID card\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 9\n    }, this), starting && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"scanner-loading\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 11\n      }, this), \" Starting camera...\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 9\n    }, this), (scanning || starting) && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"scanner-active\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"barcode-reader\",\n        className: \"scanner-viewport\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"scanner-controls\",\n        children: [torchSupported && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `scanner-ctrl-btn ${torchOn ? \"active\" : \"\"}`,\n          onClick: toggleTorch,\n          title: \"Toggle flashlight\",\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            viewBox: \"0 0 24 24\",\n            width: \"20\",\n            height: \"20\",\n            fill: torchOn ? \"currentColor\" : \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M9 18h6M10 22h4M12 2v1M4.22 4.22l.71.71M1 12h1M18.36 4.22l-.71.71M23 12h-1M15.5 7.5L12 2l-3.5 5.5a5 5 0 105 5l1-5z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 17\n          }, this), torchOn ? \"Light ON\" : \"Light\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"scanner-ctrl-btn\",\n          onClick: switchCamera,\n          title: \"Switch camera\",\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            viewBox: \"0 0 24 24\",\n            width: \"20\",\n            height: \"20\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: [/*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M20 16v4a2 2 0 01-2 2H6l4-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M4 8V4a2 2 0 012-2h12l-4 4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 329,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n              cx: \"12\",\n              cy: \"12\",\n              r: \"3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 15\n          }, this), \"Flip\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"scanner-ctrl-btn danger\",\n          onClick: stopScanner,\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            viewBox: \"0 0 24 24\",\n            width: \"20\",\n            height: \"20\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            strokeWidth: \"2\",\n            children: [/*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"18\",\n              y1: \"6\",\n              x2: \"6\",\n              y2: \"18\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 336,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n              x1: \"6\",\n              y1: \"6\",\n              x2: \"18\",\n              y2: \"18\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 15\n          }, this), \"Close\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"scanner-tip\",\n        children: \"Hold steady & close to the barcode for best results\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 9\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"scanner-error\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"\\u26A0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 11\n      }, this), \" \", error]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 277,\n    columnNumber: 5\n  }, this);\n}\n_s(BarcodeScanner, \"zRRRjGJs7DO6wUuNeBBy4vdfEec=\");\n_c = BarcodeScanner;\nexport default BarcodeScanner;\nvar _c;\n$RefreshReg$(_c, \"BarcodeScanner\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Html5Qrcode","Html5QrcodeSupportedFormats","jsxDEV","_jsxDEV","ALL_FORMATS","QR_CODE","CODE_128","CODE_39","CODE_93","EAN_13","EAN_8","UPC_A","UPC_E","ITF","CODABAR","DATA_MATRIX","PDF_417","AZTEC","BarcodeScanner","onScan","loading","_s","scanning","setScanning","starting","setStarting","error","setError","torchOn","setTorchOn","torchSupported","setTorchSupported","cameraType","setCameraType","scannerRef","lastScanRef","lastScanTimeRef","stopScanner","current","state","getState","stop","clear","e","toggleTorch","_scannerRef$current$g","_scannerRef$current","_scannerRef$current$g2","_scannerRef$current2","_videoTrack$torchFeat","track","getRunningTrackSettings","call","videoTrack","getRunningTrackCameraCapabilities","torchFeature","newState","apply","video","document","querySelector","srcObject","getVideoTracks","applyConstraints","advanced","torch","e2","console","log","switchCamera","newType","setTimeout","startScannerWithCamera","facingMode","Promise","r","el","getElementById","innerHTML","scanner","formatsToSupport","verbose","experimentalFeatures","useBarCodeDetectorIfSupported","cameraConfig","cameras","getCameras","length","rearCam","find","c","label","toLowerCase","includes","id","start","fps","qrbox","viewfinderWidth","viewfinderHeight","w","Math","floor","h","width","max","height","aspectRatio","disableFlip","decodedText","now","Date","navigator","vibrate","trim","applyHDConstraints","_track$getCapabilitie","_capabilities$focusMo","_capabilities$focusMo2","capabilities","getCapabilities","constraints","ideal","min","focusMode","push","sharpness","contrast","exposureCompensation","style","filter","err","toString","startScanner","className","children","onClick","disabled","viewBox","fill","stroke","strokeWidth","d","fileName","_jsxFileName","lineNumber","columnNumber","x1","y1","x2","y2","title","cx","cy","_c","$RefreshReg$"],"sources":["D:/GITHUB/ACM/gate-pass-app/client/src/components/BarcodeScanner.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { Html5Qrcode, Html5QrcodeSupportedFormats } from \"html5-qrcode\";\r\n\r\nconst ALL_FORMATS = [\r\n  Html5QrcodeSupportedFormats.QR_CODE,\r\n  Html5QrcodeSupportedFormats.CODE_128,\r\n  Html5QrcodeSupportedFormats.CODE_39,\r\n  Html5QrcodeSupportedFormats.CODE_93,\r\n  Html5QrcodeSupportedFormats.EAN_13,\r\n  Html5QrcodeSupportedFormats.EAN_8,\r\n  Html5QrcodeSupportedFormats.UPC_A,\r\n  Html5QrcodeSupportedFormats.UPC_E,\r\n  Html5QrcodeSupportedFormats.ITF,\r\n  Html5QrcodeSupportedFormats.CODABAR,\r\n  Html5QrcodeSupportedFormats.DATA_MATRIX,\r\n  Html5QrcodeSupportedFormats.PDF_417,\r\n  Html5QrcodeSupportedFormats.AZTEC,\r\n];\r\n\r\nfunction BarcodeScanner({ onScan, loading }) {\r\n  const [scanning, setScanning] = useState(false);\r\n  const [starting, setStarting] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [torchOn, setTorchOn] = useState(false);\r\n  const [torchSupported, setTorchSupported] = useState(false);\r\n  const [cameraType, setCameraType] = useState(\"environment\");\r\n  const scannerRef = useRef(null);\r\n  const lastScanRef = useRef(\"\");\r\n  const lastScanTimeRef = useRef(0);\r\n\r\n  const stopScanner = useCallback(async () => {\r\n    if (scannerRef.current) {\r\n      try {\r\n        const state = scannerRef.current.getState();\r\n        if (state === 2) {\r\n          await scannerRef.current.stop();\r\n        }\r\n        scannerRef.current.clear();\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n      scannerRef.current = null;\r\n    }\r\n    setScanning(false);\r\n    setStarting(false);\r\n    setTorchOn(false);\r\n    setTorchSupported(false);\r\n  }, []);\r\n\r\n  const toggleTorch = useCallback(async () => {\r\n    if (!scannerRef.current) return;\r\n    try {\r\n      const track = scannerRef.current.getRunningTrackSettings?.();\r\n      if (!track) return;\r\n      const videoTrack = scannerRef.current\r\n        .getRunningTrackCameraCapabilities?.();\r\n      if (videoTrack?.torchFeature?.()) {\r\n        const newState = !torchOn;\r\n        await videoTrack.torchFeature().apply(newState);\r\n        setTorchOn(newState);\r\n      }\r\n    } catch (e) {\r\n      // Try alternative method\r\n      try {\r\n        const video = document.querySelector(\"#barcode-reader video\");\r\n        if (video && video.srcObject) {\r\n          const track = video.srcObject.getVideoTracks()[0];\r\n          if (track) {\r\n            await track.applyConstraints({\r\n              advanced: [{ torch: !torchOn }],\r\n            });\r\n            setTorchOn(!torchOn);\r\n          }\r\n        }\r\n      } catch (e2) {\r\n        console.log(\"Torch not supported\");\r\n      }\r\n    }\r\n  }, [torchOn]);\r\n\r\n  const switchCamera = useCallback(async () => {\r\n    const newType = cameraType === \"environment\" ? \"user\" : \"environment\";\r\n    setCameraType(newType);\r\n    if (scanning) {\r\n      await stopScanner();\r\n      // Small delay then restart\r\n      setTimeout(() => {\r\n        startScannerWithCamera(newType);\r\n      }, 500);\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [cameraType, scanning, stopScanner]);\r\n\r\n  const startScannerWithCamera = useCallback(async (facingMode) => {\r\n    setError(\"\");\r\n    setStarting(true);\r\n\r\n    await new Promise((r) => setTimeout(r, 400));\r\n\r\n    try {\r\n      const el = document.getElementById(\"barcode-reader\");\r\n      if (!el) {\r\n        setError(\"Scanner element not found. Try refreshing.\");\r\n        setStarting(false);\r\n        return;\r\n      }\r\n\r\n      if (scannerRef.current) {\r\n        try { await scannerRef.current.stop(); } catch (e) {}\r\n        try { scannerRef.current.clear(); } catch (e) {}\r\n      }\r\n      el.innerHTML = \"\";\r\n\r\n      const scanner = new Html5Qrcode(\"barcode-reader\", {\r\n        formatsToSupport: ALL_FORMATS,\r\n        verbose: false,\r\n        experimentalFeatures: {\r\n          useBarCodeDetectorIfSupported: true,  // Use native BarcodeDetector API if available (faster + better blur handling)\r\n        },\r\n      });\r\n      scannerRef.current = scanner;\r\n\r\n      // Get available cameras and pick rear HD camera\r\n      let cameraConfig = { facingMode: facingMode || \"environment\" };\r\n      try {\r\n        const cameras = await Html5Qrcode.getCameras();\r\n        if (cameras && cameras.length > 0) {\r\n          // Prefer rear camera\r\n          const rearCam = cameras.find(c =>\r\n            c.label.toLowerCase().includes(\"back\") ||\r\n            c.label.toLowerCase().includes(\"rear\") ||\r\n            c.label.toLowerCase().includes(\"environment\")\r\n          );\r\n          if (rearCam && facingMode !== \"user\") {\r\n            cameraConfig = rearCam.id;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // fallback to facingMode\r\n      }\r\n\r\n      await scanner.start(\r\n        cameraConfig,\r\n        {\r\n          fps: 15,                    // Higher FPS = more scan attempts\r\n          qrbox: (viewfinderWidth, viewfinderHeight) => {\r\n            // Use 85% of the viewport for scanning area — larger = better for blur\r\n            const w = Math.floor(viewfinderWidth * 0.85);\r\n            const h = Math.floor(viewfinderHeight * 0.65);\r\n            return { width: Math.max(w, 250), height: Math.max(h, 150) };\r\n          },\r\n          aspectRatio: 1.5,\r\n          disableFlip: false,\r\n          experimentalFeatures: {\r\n            useBarCodeDetectorIfSupported: true,\r\n          },\r\n        },\r\n        (decodedText) => {\r\n          // Debounce: prevent rapid duplicate scans\r\n          const now = Date.now();\r\n          if (\r\n            decodedText === lastScanRef.current &&\r\n            now - lastScanTimeRef.current < 3000\r\n          ) {\r\n            return;\r\n          }\r\n          lastScanRef.current = decodedText;\r\n          lastScanTimeRef.current = now;\r\n\r\n          // Vibrate on successful scan (mobile)\r\n          if (navigator.vibrate) navigator.vibrate(200);\r\n\r\n          onScan(decodedText.trim());\r\n          stopScanner();\r\n        },\r\n        () => {}\r\n      );\r\n\r\n      setScanning(true);\r\n      setStarting(false);\r\n\r\n      // After scanner starts, force HD + continuous autofocus + sharpness\r\n      const applyHDConstraints = async () => {\r\n        try {\r\n          const video = document.querySelector(\"#barcode-reader video\");\r\n          if (!video || !video.srcObject) return;\r\n\r\n          const track = video.srcObject.getVideoTracks()[0];\r\n          if (!track) return;\r\n\r\n          const capabilities = track.getCapabilities?.() || {};\r\n\r\n          // Build constraints\r\n          const constraints = {};\r\n          const advanced = [];\r\n\r\n          // Force highest resolution possible\r\n          if (capabilities.width) {\r\n            constraints.width = { ideal: Math.min(capabilities.width.max || 1920, 1920) };\r\n          }\r\n          if (capabilities.height) {\r\n            constraints.height = { ideal: Math.min(capabilities.height.max || 1080, 1080) };\r\n          }\r\n\r\n          // Continuous autofocus — CRITICAL for blur\r\n          if (capabilities.focusMode?.includes(\"continuous\")) {\r\n            advanced.push({ focusMode: \"continuous\" });\r\n          } else if (capabilities.focusMode?.includes(\"auto\")) {\r\n            advanced.push({ focusMode: \"auto\" });\r\n          }\r\n\r\n          // Sharpness boost if supported\r\n          if (capabilities.sharpness) {\r\n            advanced.push({ sharpness: capabilities.sharpness.max || 100 });\r\n          }\r\n\r\n          // Contrast boost if supported  \r\n          if (capabilities.contrast) {\r\n            advanced.push({ contrast: Math.min((capabilities.contrast.max || 100), 150) });\r\n          }\r\n\r\n          // Exposure compensation for clearer image\r\n          if (capabilities.exposureCompensation) {\r\n            advanced.push({ exposureCompensation: 0 });\r\n          }\r\n\r\n          // Torch support check\r\n          if (capabilities.torch) {\r\n            setTorchSupported(true);\r\n          }\r\n\r\n          if (advanced.length > 0) {\r\n            constraints.advanced = advanced;\r\n          }\r\n\r\n          await track.applyConstraints(constraints);\r\n\r\n          // Apply CSS sharpening filter on the video for visual clarity\r\n          video.style.filter = \"contrast(1.15) brightness(1.05)\";\r\n        } catch (e) {\r\n          // Non-critical, ignore\r\n        }\r\n      };\r\n\r\n      // Apply immediately + retry after 1s (some cameras need time)\r\n      setTimeout(applyHDConstraints, 500);\r\n      setTimeout(applyHDConstraints, 1500);\r\n    } catch (err) {\r\n      console.error(\"Scanner error:\", err);\r\n      setStarting(false);\r\n      if (err.toString().includes(\"NotAllowedError\")) {\r\n        setError(\"Camera permission denied. Please allow camera access in your browser settings.\");\r\n      } else if (err.toString().includes(\"NotFoundError\")) {\r\n        setError(\"No camera found on this device.\");\r\n      } else if (err.toString().includes(\"NotReadableError\")) {\r\n        setError(\"Camera is in use by another app. Please close it and try again.\");\r\n      } else {\r\n        setError(\"Failed to start camera: \" + err.toString());\r\n      }\r\n    }\r\n  }, [onScan, stopScanner]);\r\n\r\n  const startScanner = useCallback(() => {\r\n    startScannerWithCamera(cameraType);\r\n  }, [cameraType, startScannerWithCamera]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (scannerRef.current) {\r\n        try { scannerRef.current.stop(); } catch (e) {}\r\n        try { scannerRef.current.clear(); } catch (e) {}\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"barcode-scanner\">\r\n      {!scanning && !starting && (\r\n        <div className=\"scanner-start\">\r\n          <button\r\n            className=\"start-scan-btn\"\r\n            onClick={startScanner}\r\n            disabled={loading}\r\n          >\r\n            <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M3 7V5a2 2 0 012-2h2\" />\r\n              <path d=\"M17 3h2a2 2 0 012 2v2\" />\r\n              <path d=\"M21 17v2a2 2 0 01-2 2h-2\" />\r\n              <path d=\"M7 21H5a2 2 0 01-2-2v-2\" />\r\n              <line x1=\"7\" y1=\"12\" x2=\"17\" y2=\"12\" />\r\n              <line x1=\"7\" y1=\"8\" x2=\"13\" y2=\"8\" />\r\n              <line x1=\"7\" y1=\"16\" x2=\"15\" y2=\"16\" />\r\n            </svg>\r\n            Open Camera &amp; Scan Barcode\r\n          </button>\r\n          <p className=\"scanner-hint\">Point your camera at the barcode on the participant's ID card</p>\r\n        </div>\r\n      )}\r\n\r\n      {starting && (\r\n        <div className=\"scanner-loading\">\r\n          <span className=\"spinner\" /> Starting camera...\r\n        </div>\r\n      )}\r\n\r\n      {(scanning || starting) && (\r\n        <div className=\"scanner-active\">\r\n          <div id=\"barcode-reader\" className=\"scanner-viewport\" />\r\n          <div className=\"scanner-controls\">\r\n            {torchSupported && (\r\n              <button\r\n                className={`scanner-ctrl-btn ${torchOn ? \"active\" : \"\"}`}\r\n                onClick={toggleTorch}\r\n                title=\"Toggle flashlight\"\r\n              >\r\n                <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill={torchOn ? \"currentColor\" : \"none\"} stroke=\"currentColor\" strokeWidth=\"2\">\r\n                  <path d=\"M9 18h6M10 22h4M12 2v1M4.22 4.22l.71.71M1 12h1M18.36 4.22l-.71.71M23 12h-1M15.5 7.5L12 2l-3.5 5.5a5 5 0 105 5l1-5z\"/>\r\n                </svg>\r\n                {torchOn ? \"Light ON\" : \"Light\"}\r\n              </button>\r\n            )}\r\n            <button\r\n              className=\"scanner-ctrl-btn\"\r\n              onClick={switchCamera}\r\n              title=\"Switch camera\"\r\n            >\r\n              <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <path d=\"M20 16v4a2 2 0 01-2 2H6l4-4\"/>\r\n                <path d=\"M4 8V4a2 2 0 012-2h12l-4 4\"/>\r\n                <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n              </svg>\r\n              Flip\r\n            </button>\r\n            <button className=\"scanner-ctrl-btn danger\" onClick={stopScanner}>\r\n              <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\r\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n              </svg>\r\n              Close\r\n            </button>\r\n          </div>\r\n          <p className=\"scanner-tip\">Hold steady &amp; close to the barcode for best results</p>\r\n        </div>\r\n      )}\r\n\r\n      {error && (\r\n        <div className=\"scanner-error\">\r\n          <span>⚠</span> {error}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BarcodeScanner;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}